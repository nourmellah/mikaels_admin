[supervisord]
nodaemon=true
user=root
logfile=/dev/null
pidfile=/tmp/supervisord.pid

[program:postgres]
command=/usr/lib/postgresql/16/bin/postgres -D /var/lib/postgresql/data
user=postgres
priority=10
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0

[program:server]
directory=/app
; wait for PG with explicit user, then start API
command=/bin/bash -lc "until /usr/lib/postgresql/16/bin/pg_isready -h 127.0.0.1 -p 5432 -U postgres; do echo 'waiting for postgresâ€¦'; sleep 1; done; node ./bin/www"
priority=30
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
environment=PORT="3000"
